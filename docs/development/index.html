<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Development Tips - Coronium ChatterBox</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  <link href="../css/code.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Development Tips";
    var mkdocs_page_input_path = "development.md";
    var mkdocs_page_url = "/development/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Coronium ChatterBox</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Introduction</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../guide/">Client Guide</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../events/">Client Events</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../actions/">Client Actions</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../server/">Server Guide</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Development Tips</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#event-listeners">Event Listeners</a></li>
    

    <li class="toctree-l2"><a href="#client-names">Client Names</a></li>
    

    <li class="toctree-l2"><a href="#system-messages">System Messages</a></li>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../example/">Example Setup</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../about/">About</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Coronium ChatterBox</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Development Tips</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="event-listeners">Event Listeners</h2>
<p>Events can be registered to different listeners to take action on them. In almost all cases, there should only be one listener for an event at any given time. This means you will need to be mindful of "removing" a listener when appropiate.</p>
<p>To remove an event listener use <strong>removeEventListener</strong>:</p>
<pre class="codehilite"><code class="language-lua">cb.events:removeEventListener('OnJoined', onJoined)</code></pre>


<p>You should always be listening for the <a href="../events#onclientlist">OnClientList</a> and <a href="../events#onclosed">OnClosed</a> event throughout your application while connected to your instance. The <a href="../events#onclientlist">OnClientList</a> event provides a syncing point for the clients currently connected to the room. This event is trigged when a client joins, leaves, or makes a name change in the room. <strong><em>If you're not listening for this event, you will not know what the current state of the room is.</em></strong></p>
<p>The <a href="../events#onclosed">OnClosed</a> event is important for clean up associated with a client disconnecting from the server.</p>
<p>The <a href="../events#onjoined">OnJoined</a> and <a href="../events#onleft">OnLeft</a> events are helpful for cleaning up client specfic state.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Don't try to manage your client list using the <a href="../events#onjoined">OnJoined</a> and <a href="../events#onleft">OnLeft</a> events. Instead listen for the <a href="../events#onclientlist">OnClientList</a> event to keep your client list current.</p>
</div>
<h2 id="client-names">Client Names</h2>
<p>When a client connects to a room, it's possible for two (or more) clients to have the same name. A clients name can be changed with the <a href="../actions#changename">changeName</a> action. If you want to impose unique names, you can write logic in the <a href="../events#onjoined">OnJoined</a> event to check the client list for a matching name, and prompt the user to change their name.</p>
<h2 id="system-messages">System Messages</h2>
<p>System messages can facilitate more complex applications. A system message contains two properties, an <strong>action</strong> and <strong>payload</strong>. Using this message type allows you to control your application without having to parse through "chat" based messages.</p>
<p>The <strong>action</strong> property should be a unique key that you can check for on the <a href="../events#onsystemmessage">OnSystemMessage</a> event. The <strong>payload</strong> is any data required for that action. It can be a simple value, or a complex data table.</p>
<p>By listening for system messages, and checking the <strong>action</strong> key you can implement limitless functionality:</p>
<pre class="codehilite"><code class="language-lua">local cb = require('chatterbox.client')

local function onSystemMessage( evt )
  local action = evt.action
  local payload = evt.payload

  if action == 'open_broswer' then
    --possible function, payload is a data table
    openWebView(payload.url)
  elseif action == 'flash_screen' then
    --possible function, payload contains a number
    flashScreen({repeat=payload})
  end
end

cb.events:addEventListener('OnSystemMessage', onSystemMessage)</code></pre>


<div class="admonition important">
<p class="admonition-title">Important</p>
<p>System messages are always broadcast to the entire room. If you want an event to only operate on a specific client, pass the clients ID along in the payload and check against it.</p>
</div>
<p>Acting on a specific client:</p>
<pre class="codehilite"><code class="language-lua">local cb = require('chatterbox.client')

local function onSystemMessage( evt )
  local action = evt.action
  local payload = evt.payload --a data table

  if action == 'set_score' then
    if payload.client_id == cs:getId() then
      client_score = payload.score
    end
  end
end

cb.events:addEventListener('OnSystemMessage', onSystemMessage)</code></pre>


<p>You can also sync application state by passing a data table as the <code>payload</code>:</p>
<pre class="codehilite"><code class="language-lua">...

local function onSystemMessage( evt )
  if evt.action == 'state' then
    app_state = evt.payload
    --do stuff with the app_state
  end
end

...</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../example/" class="btn btn-neutral float-right" title="Example Setup">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../server/" class="btn btn-neutral" title="Server Guide"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>&copy;2017 C. Byerley - develephant.com</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../server/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../example/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../js/theme.js"></script>

</body>
</html>
